#include "core/core.h"
#include "utils/boot_psi.h"
#include "platform/memory_map.h"
#include "platform/reg_access.h"
#include "dbg/raw_print.h"

#include "hw_regs/afifm.h"
#include "hw_regs/crf_apb.h"
#include "hw_regs/ddrc.h"
#include "hw_regs/ddr_phy.h"
#include "hw_regs/ddr_qos_ctrl.h"

#define DDR_PHY_BISTLSR_OFFSET                                                     0x414
#define DDR_PHY_GPR0_OFFSET                                                        0X0C0
#define DDR_PHY_PGCR1_OFFSET 													   0x014
#define DDRC_DBG0_OFFSET                                                           0X300

__attribute__((__section__(".hwregs")))
static PSI_IWord const ddr_init[] = {
	PSI_FAR_WRITE_MASKED_32(CRF_APB, RST_DDR_SS, 0x00000008U, 0x00000008U),

	PSI_SET_REGISTER_BANK(DDRC),
	PSI_WRITE_MASKED_32(DDRC, MSTR, 0xE30FBE3DU, 0x81040010U),
	PSI_WRITE_MASKED_32(DDRC, MRCTRL0, 0x8000F03FU, 0x00000030U),
	PSI_WRITE_MASKED_32(DDRC, DERATEEN, 0x000003F3U, 0x00000300U),
	PSI_WRITE_MASKED_32(DDRC, DERATEINT, 0xFFFFFFFFU, 0x00800000U),
	PSI_WRITE_MASKED_32(DDRC, PWRCTL, 0x0000007FU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, PWRTMG, 0x00FFFF1FU, 0x00409410U),
	PSI_WRITE_MASKED_32(DDRC, RFSHCTL0, 0x00F1F1F4U, 0x00210000U),
	PSI_WRITE_MASKED_32(DDRC, RFSHCTL1, 0x0FFF0FFFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, RFSHCTL3, 0x00000073U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, RFSHTMG, 0x0FFF83FFU, 0x009280D2U),
	PSI_WRITE_MASKED_32(DDRC, ECCCFG0, 0x00000017U, 0x00000010U),
	PSI_WRITE_MASKED_32(DDRC, ECCCFG1, 0x00000003U, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, CRCPARCTL1, 0x3F000391U, 0x10000200U),
	PSI_WRITE_MASKED_32(DDRC, CRCPARCTL2, 0x01FF1F3FU, 0x0048051FU),
	PSI_WRITE_MASKED_32(DDRC, INIT0, 0xC3FF0FFFU, 0x00020126U),
	PSI_WRITE_MASKED_32(DDRC, INIT1, 0x01FF7F0FU, 0x00020000U),
	PSI_WRITE_MASKED_32(DDRC, INIT2, 0x0000FF0FU, 0x00002705U),
	PSI_WRITE_MASKED_32(DDRC, INIT3, 0xFFFFFFFFU, 0x09340301U),
	PSI_WRITE_MASKED_32(DDRC, INIT4, 0xFFFFFFFFU, 0x00180200U),
	PSI_WRITE_MASKED_32(DDRC, INIT5, 0x00FF03FFU, 0x00210004U),
	PSI_WRITE_MASKED_32(DDRC, INIT6, 0xFFFFFFFFU, 0x000006C0U),
	PSI_WRITE_MASKED_32(DDRC, INIT7, 0xFFFF0000U, 0x08190000U),
	PSI_WRITE_MASKED_32(DDRC, DIMMCTL, 0x0000003FU, 0x00000010U),
	PSI_WRITE_MASKED_32(DDRC, RANKCTL, 0x00000FFFU, 0x0000066FU),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG0, 0x7F3F7F3FU, 0x11122813U),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG1, 0x001F1F7FU, 0x0004041CU),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG2, 0x3F3F3F3FU, 0x0608070DU),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG3, 0x3FF3F3FFU, 0x0050400CU),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG4, 0x1F0F0F1FU, 0x08030409U),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG5, 0x0F0F3F1FU, 0x06060403U),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG6, 0x0F0F000FU, 0x01010004U),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG7, 0x00000F0FU, 0x00000606U),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG8, 0x7F7F7F7FU, 0x05050D08U),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG9, 0x40070F3FU, 0x0002040AU),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG11, 0x7F1F031FU, 0x1308010EU),
	PSI_WRITE_MASKED_32(DDRC, DRAMTMG12, 0x00030F1FU, 0x00020608U),
	PSI_WRITE_MASKED_32(DDRC, ZQCTL0, 0xF7FF03FFU, 0x81000040U),
	PSI_WRITE_MASKED_32(DDRC, ZQCTL1, 0x3FFFFFFFU, 0x0201C9C2U),
	PSI_WRITE_MASKED_32(DDRC, DFITMG0, 0x1FBFBF3FU, 0x048C8209U),
	PSI_WRITE_MASKED_32(DDRC, DFITMG1, 0xF31F0F0FU, 0x00030304U),
	PSI_WRITE_MASKED_32(DDRC, DFILPCFG0, 0x0FF1F1F1U, 0x07000101U),
	PSI_WRITE_MASKED_32(DDRC, DFILPCFG1, 0x000000F1U, 0x00000021U),
	PSI_WRITE_MASKED_32(DDRC, DFIUPD0, 0xC3FF03FFU, 0x00400003U),
	PSI_WRITE_MASKED_32(DDRC, DFIUPD1, 0x00FF00FFU, 0x00C800FFU),
	PSI_WRITE_MASKED_32(DDRC, DFIMISC, 0x00000007U, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DFITMG2, 0x00003F3FU, 0x00000A07U),
	PSI_WRITE_MASKED_32(DDRC, DBICTL, 0x00000007U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP0, 0x0000001FU, 0x0000001FU),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP1, 0x001F1F1FU, 0x001F0909U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP2, 0x0F0F0F0FU, 0x01010100U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP3, 0x0F0F0F0FU, 0x01010101U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP4, 0x00000F0FU, 0x00000F0FU),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP5, 0x0F0F0F0FU, 0x070F0707U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP6, 0x8F0F0F0FU, 0x07070707U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP7, 0x00000F0FU, 0x00000F0FU),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP8, 0x00001F1FU, 0x00001F01U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP9, 0x0F0F0F0FU, 0x07070707U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP10, 0x0F0F0F0FU, 0x07070707U),
	PSI_WRITE_MASKED_32(DDRC, ADDRMAP11, 0x0000000FU, 0x00000007U),
	PSI_WRITE_MASKED_32(DDRC, ODTCFG, 0x0F1F0F7CU, 0x0600060CU),
	PSI_WRITE_MASKED_32(DDRC, ODTMAP, 0x00003333U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, SCHED, 0x7FFF3F07U, 0x01002001U),
	PSI_WRITE_MASKED_32(DDRC, PERFLPR1, 0xFF00FFFFU, 0x08000040U),
	PSI_WRITE_MASKED_32(DDRC, PERFWR1, 0xFF00FFFFU, 0x08000040U),
	PSI_WRITE_MASKED_32(DDRC, DQMAP0, 0xFFFFFFFFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DQMAP1, 0xFFFFFFFFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DQMAP2, 0xFFFFFFFFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DQMAP3, 0xFFFFFFFFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DQMAP4, 0x0000FFFFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DQMAP5, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, DBG0, 0x00000011U, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, DBGCMD, 0x80000033U, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, SWCTL, 0x00000001U, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, PCCFG, 0x00000111U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGR_0, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGW_0, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCTRL_0, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS0_0, 0x0033000FU, 0x0020000BU),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS1_0, 0x07FF07FFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, PCFGR_1, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGW_1, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCTRL_1, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS0_1, 0x03330F0FU, 0x02000B03U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS1_1, 0x07FF07FFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, PCFGR_2, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGW_2, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCTRL_2, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS0_2, 0x03330F0FU, 0x02000B03U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS1_2, 0x07FF07FFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, PCFGR_3, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGW_3, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCTRL_3, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS0_3, 0x0033000FU, 0x00100003U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS1_3, 0x07FF07FFU, 0x0000004FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGWQOS0_3, 0x0033000FU, 0x00100003U),
	PSI_WRITE_MASKED_32(DDRC, PCFGWQOS1_3, 0x000007FFU, 0x0000004FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGR_4, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGW_4, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCTRL_4, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS0_4, 0x0033000FU, 0x00100003U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS1_4, 0x07FF07FFU, 0x0000004FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGWQOS0_4, 0x0033000FU, 0x00100003U),
	PSI_WRITE_MASKED_32(DDRC, PCFGWQOS1_4, 0x000007FFU, 0x0000004FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGR_5, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGW_5, 0x000073FFU, 0x0000200FU),
	PSI_WRITE_MASKED_32(DDRC, PCTRL_5, 0x00000001U, 0x00000001U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS0_5, 0x0033000FU, 0x00100003U),
	PSI_WRITE_MASKED_32(DDRC, PCFGQOS1_5, 0x07FF07FFU, 0x0000004FU),
	PSI_WRITE_MASKED_32(DDRC, PCFGWQOS0_5, 0x0033000FU, 0x00100003U),
	PSI_WRITE_MASKED_32(DDRC, PCFGWQOS1_5, 0x000007FFU, 0x0000004FU),
	PSI_WRITE_MASKED_32(DDRC, SARBASE0, 0x000001FFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, SARSIZE0, 0x000000FFU, 0x00000000U),
	PSI_WRITE_MASKED_32(DDRC, SARBASE1, 0x000001FFU, 0x00000010U),
	PSI_WRITE_MASKED_32(DDRC, SARSIZE1, 0x000000FFU, 0x0000000FU),
	PSI_WRITE_MASKED_32(DDRC, DFITMG0_SHADOW, 0x1FBFBF3FU, 0x07828002U),

	PSI_FAR_WRITE_MASKED_32(CRF_APB, RST_DDR_SS, 0x0000000CU, 0x00000000U),

	PSI_SET_REGISTER_BANK(DDR_PHY),
	PSI_WRITE_32(DDR_PHY, PGCR0, 0x07001E00U),
	PSI_WRITE_32(DDR_PHY, PGCR2, 0x00F12090U),
	PSI_WRITE_32(DDR_PHY, PGCR3, 0x55AA5480U),
	PSI_WRITE_32(DDR_PHY, PGCR5, 0x010100F4U),
	PSI_WRITE_32(DDR_PHY, PTR0, 0x4B025810U),
	PSI_WRITE_32(DDR_PHY, PTR1, 0xEA601518U),
	PSI_WRITE_32(DDR_PHY, PLLCR0, 0x000E0000U),
	PSI_WRITE_32(DDR_PHY, DSGCR, 0x02A04161U),
	PSI_WRITE_32(DDR_PHY, GPR0, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, GPR1, 0x000000E4U),
	PSI_WRITE_32(DDR_PHY, DCR, 0x0800040CU),
	PSI_WRITE_32(DDR_PHY, DTPR0, 0x08261009U),
	PSI_WRITE_32(DDR_PHY, DTPR1, 0x28240008U),
	PSI_WRITE_32(DDR_PHY, DTPR2, 0x000F0300U),
	PSI_WRITE_32(DDR_PHY, DTPR3, 0x83000800U),
	PSI_WRITE_32(DDR_PHY, DTPR4, 0x01A42B08U),
	PSI_WRITE_32(DDR_PHY, DTPR5, 0x00371009U),
	PSI_WRITE_32(DDR_PHY, DTPR6, 0x00000C10U),
	PSI_WRITE_32(DDR_PHY, RDIMMGCR0, 0x08400020U),
	PSI_WRITE_32(DDR_PHY, RDIMMGCR1, 0x00000C80U),
	PSI_WRITE_32(DDR_PHY, RDIMMCR0, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, RDIMMCR1, 0x00000300U),
	PSI_WRITE_32(DDR_PHY, MR0, 0x00000834U),
	PSI_WRITE_32(DDR_PHY, MR1, 0x00000301U),
	PSI_WRITE_32(DDR_PHY, MR2, 0x00000018U),
	PSI_WRITE_32(DDR_PHY, MR3, 0x00000200U),
	PSI_WRITE_32(DDR_PHY, MR4, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, MR5, 0x000006C0U),
	PSI_WRITE_32(DDR_PHY, MR6, 0x00000819U),
	PSI_WRITE_32(DDR_PHY, MR11, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, MR12, 0x0000004DU),
	PSI_WRITE_32(DDR_PHY, MR13, 0x00000008U),
	PSI_WRITE_32(DDR_PHY, MR14, 0x0000004DU),
	PSI_WRITE_32(DDR_PHY, MR22, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, DTCR0, 0x800091C7U),
	PSI_WRITE_32(DDR_PHY, DTCR1, 0x00010236U),
	PSI_WRITE_32(DDR_PHY, CATR0, 0x00141054U),
	PSI_WRITE_32(DDR_PHY, DQSDR0, 0x00088000U),
	PSI_WRITE_32(DDR_PHY, BISTLSR, 0x12341000U),
	PSI_WRITE_32(DDR_PHY, RIOCR5, 0x00000005U),
	PSI_WRITE_32(DDR_PHY, ACIOCR0, 0x30000028U),
	PSI_WRITE_32(DDR_PHY, ACIOCR2, 0x0A000000U),
	PSI_WRITE_32(DDR_PHY, ACIOCR3, 0x00000009U),
	PSI_WRITE_32(DDR_PHY, ACIOCR4, 0x0A000000U),
	PSI_WRITE_32(DDR_PHY, IOVCR0, 0x0300B0CEU),
	PSI_WRITE_32(DDR_PHY, VTCR0, 0xF9032019U),
	PSI_WRITE_32(DDR_PHY, VTCR1, 0x07F001E3U),
	PSI_WRITE_32(DDR_PHY, ACBDLR1, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, ACBDLR2, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, ACBDLR6, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, ACBDLR7, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, ACBDLR8, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, ACBDLR9, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, ZQCR, 0x008AEA58U),
	PSI_WRITE_32(DDR_PHY, ZQ0PR0, 0x000079DDU),
	PSI_WRITE_32(DDR_PHY, ZQ0OR0, 0x01E10210U),
	PSI_WRITE_32(DDR_PHY, ZQ0OR1, 0x01E10000U),
	PSI_WRITE_32(DDR_PHY, ZQ1PR0, 0x00087BDBU),
	PSI_WRITE_32(DDR_PHY, DX0GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX0GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX0GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX0GCR4, 0x0E00B03CU),
	PSI_WRITE_32(DDR_PHY, DX0GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX0GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX1GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX1GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX1GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX1GCR4, 0x0E00B03CU),
	PSI_WRITE_32(DDR_PHY, DX1GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX1GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX2GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX2GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX2GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX2GCR4, 0x0E00B004U),
	PSI_WRITE_32(DDR_PHY, DX2GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX2GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX3GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX3GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX3GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX3GCR4, 0x0E00B004U),
	PSI_WRITE_32(DDR_PHY, DX3GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX3GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX4GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX4GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX4GCR2, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, DX4GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX4GCR4, 0x0E00B004U),
	PSI_WRITE_32(DDR_PHY, DX4GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX4GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX5GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX5GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX5GCR2, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, DX5GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX5GCR4, 0x0E00B03CU),
	PSI_WRITE_32(DDR_PHY, DX5GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX5GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX6GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX6GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX6GCR2, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, DX6GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX6GCR4, 0x0E00B004U),
	PSI_WRITE_32(DDR_PHY, DX6GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX6GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX7GCR0, 0x40800604U),
	PSI_WRITE_32(DDR_PHY, DX7GCR1, 0x00007FFFU),
	PSI_WRITE_32(DDR_PHY, DX7GCR2, 0x00000000U),
	PSI_WRITE_32(DDR_PHY, DX7GCR3, 0x3F000008U),
	PSI_WRITE_32(DDR_PHY, DX7GCR4, 0x0E00B03CU),
	PSI_WRITE_32(DDR_PHY, DX7GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX7GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX8GCR0, 0x80803660U),
	PSI_WRITE_32(DDR_PHY, DX8GCR1, 0x55556000U),
	PSI_WRITE_32(DDR_PHY, DX8GCR2, 0xAAAAAAAAU),
	PSI_WRITE_32(DDR_PHY, DX8GCR3, 0x0029A4A4U),
	PSI_WRITE_32(DDR_PHY, DX8GCR4, 0x0C00B000U),
	PSI_WRITE_32(DDR_PHY, DX8GCR5, 0x09094F4FU),
	PSI_WRITE_32(DDR_PHY, DX8GCR6, 0x09092B2BU),
	PSI_WRITE_32(DDR_PHY, DX8SL0OSC, 0x2A019FFEU),
	PSI_WRITE_32(DDR_PHY, DX8SL0PLLCR0, 0x000E0000U),
	PSI_WRITE_32(DDR_PHY, DX8SL0DQSCTL, 0x01264300U),
	PSI_WRITE_32(DDR_PHY, DX8SL0DXCTL2, 0x00041800U),
	PSI_WRITE_32(DDR_PHY, DX8SL0IOCR, 0x70800000U),
	PSI_WRITE_32(DDR_PHY, DX8SL1OSC, 0x2A019FFEU),
	PSI_WRITE_32(DDR_PHY, DX8SL1PLLCR0, 0x000E0000U),
	PSI_WRITE_32(DDR_PHY, DX8SL1DQSCTL, 0x01264300U),
	PSI_WRITE_32(DDR_PHY, DX8SL1DXCTL2, 0x00041800U),
	PSI_WRITE_32(DDR_PHY, DX8SL1IOCR, 0x70800000U),
	PSI_WRITE_32(DDR_PHY, DX8SL2OSC, 0x2A019FFEU),
	PSI_WRITE_32(DDR_PHY, DX8SL2PLLCR0, 0x000E0000U),
	PSI_WRITE_32(DDR_PHY, DX8SL2DQSCTL, 0x01264300U),
	PSI_WRITE_32(DDR_PHY, DX8SL2DXCTL2, 0x00041800U),
	PSI_WRITE_32(DDR_PHY, DX8SL2IOCR, 0x70800000U),
	PSI_WRITE_32(DDR_PHY, DX8SL3OSC, 0x2A019FFEU),
	PSI_WRITE_32(DDR_PHY, DX8SL3PLLCR0, 0x000E0000U),
	PSI_WRITE_32(DDR_PHY, DX8SL3DQSCTL, 0x01264300U),
	PSI_WRITE_32(DDR_PHY, DX8SL3DXCTL2, 0x00041800U),
	PSI_WRITE_32(DDR_PHY, DX8SL3IOCR, 0x70800000U),
	PSI_WRITE_32(DDR_PHY, DX8SL4OSC, 0x15019FFEU),
	PSI_WRITE_32(DDR_PHY, DX8SL4PLLCR0, 0x200E0000U),
	PSI_WRITE_32(DDR_PHY, DX8SL4DQSCTL, 0x01266300U),
	PSI_WRITE_32(DDR_PHY, DX8SL4DXCTL2, 0x00041800U),
	PSI_WRITE_32(DDR_PHY, DX8SL4IOCR, 0x70400000U),
	PSI_WRITE_32(DDR_PHY, DX8SLBDQSCTL, 0x012643C4U),

	PSI_END_PROGRAM
};

__attribute__((__section__(".hwregs")))
static PSI_IWord const ddr_qos_init[] = {
	PSI_SET_REGISTER_BANK(S_AXI_HP0_FPD),
	PSI_WRITE_MASKED_32(S_AXI_HP0_FPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_HP0_FPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_SET_REGISTER_BANK(S_AXI_HP1_FPD),
	PSI_WRITE_MASKED_32(S_AXI_HP1_FPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_HP1_FPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_SET_REGISTER_BANK(S_AXI_HP2_FPD),
	PSI_WRITE_MASKED_32(S_AXI_HP2_FPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_HP2_FPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_SET_REGISTER_BANK(S_AXI_HP3_FPD),
	PSI_WRITE_MASKED_32(S_AXI_HP3_FPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_HP3_FPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_SET_REGISTER_BANK(S_AXI_HPC0_FPD),
	PSI_WRITE_MASKED_32(S_AXI_HPC0_FPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_HPC0_FPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_SET_REGISTER_BANK(S_AXI_HPC1_FPD),
	PSI_WRITE_MASKED_32(S_AXI_HPC1_FPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_HPC1_FPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_SET_REGISTER_BANK(S_AXI_LPD),
	PSI_WRITE_MASKED_32(S_AXI_LPD, RDQOS, 0x0000000FU, 0x00000000U),
	PSI_WRITE_MASKED_32(S_AXI_LPD, WRQOS, 0x0000000FU, 0x00000000U),

	PSI_END_PROGRAM
};


static void ddrPhybringup(void)
{
	unsigned int regval = 0;
	unsigned int pll_retry = 10;
	unsigned int pll_locked = 0;

	while ((pll_retry > 0) && (!pll_locked)) {
		HW_REG_WRITE1(DDR_PHY, PIR, 0x00040010);
		HW_REG_WRITE1(DDR_PHY, PIR, 0x00040011);

		while ((HW_REG_READ1(DDR_PHY, PGSR0) & 0x1) != 1) {
			/*****TODO*****/
			/*TIMEOUT poll mechanism need to be inserted in this block*/
		}


		pll_locked  = (HW_REG_READ1(DDR_PHY, PGSR0) & 0x80000000) >> 31;
		pll_locked &= (HW_REG_READ1(DDR_PHY, DX0GSR0) & 0x10000) >> 16;
		pll_locked &= (HW_REG_READ1(DDR_PHY, DX2GSR0) & 0x10000) >> 16;
		pll_locked &= (HW_REG_READ1(DDR_PHY, DX4GSR0) & 0x10000) >> 16;
		pll_locked &= (HW_REG_READ1(DDR_PHY, DX6GSR0) & 0x10000) >> 16;
		pll_retry--;
	}

	HW_REG_MERGE(DDR_PHY, GPR1, 0x00000001U, 0x00000001U);

	if(!pll_locked) {
		raw_debug_printf("DDR PLL did not lock, DDR Init failed!!!\n");
		return;
	}

	HW_REG_WRITE1(DDR_PHY, PIR, 0x00040063U);
	/* PHY BRINGUP SEQ */
	while ((HW_REG_READ1(DDR_PHY, PGSR0) & 0x0000000FU) != 0x0000000FU) {
		/*****TODO*****/
		/*TIMEOUT poll mechanism need to be inserted in this block*/
	}

	HW_REG_SET_BIT(DDR_PHY, PIR, INIT);
		/* poll for PHY initialization to complete */
	while ((HW_REG_READ1(DDR_PHY, PGSR0) & 0x000000FFU) != 0x0000001FU) {
		/*****TODO*****/
		/*TIMEOUT poll mechanism need to be inserted in this block*/
	}

	HW_REG_WRITE1(DDRC, DFIMISC, 0x00000001U);
	HW_REG_WRITE1(DDRC, SWCTL, 0x00000001U);
	while ((HW_REG_READ1(DDRC, STAT) & 0x0000000FU) != 0x00000001U) {
		/*****TODO*****/
		/*TIMEOUT poll mechanism need to be inserted in this block*/
	}

	HW_REG_MERGE(DDR_PHY, PGCR1, 0x00000040U, (0x00000001U<< 0x06U));

	HW_REG_WRITE1(DDR_PHY, PIR, 0x0004FE01);

	do {
		regval = HW_REG_READ1(DDR_PHY, PGSR0);
	} while (regval != 0x80000FFF);

	regval = ((HW_REG_READ1(DDR_PHY, PGSR0) & 0x1FFF0000) >>18);
	if(regval != 0) {
		raw_debug_printf("DDR PGSR0 != 0, DDR Init failed!!!\n");
		return;
	}

// Run Vref training in static read mode
	HW_REG_WRITE1(DDR_PHY, DTCR0, 0x100091C7U);

	uint32_t cur_R006_tREFPRD = HW_REG_READ1(DDR_PHY, PGCR2);
	// this doesn't appear to do anything but i've left it in, in case its needed for a trigger
	HW_REG_MERGE(DDR_PHY, PGCR2, 0x0003FFFFU, cur_R006_tREFPRD);

	HW_REG_MERGE_FIELD(DDR_PHY, PGCR3, RDMODE, 0x00000003U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL0DXCTL2, RDMODE, 0x00000003U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL1DXCTL2, RDMODE, 0x00000003U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL2DXCTL2, RDMODE, 0x00000003U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL3DXCTL2, RDMODE, 0x00000003U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL4DXCTL2, RDMODE, 0x00000003U);

	HW_REG_WRITE1(DDR_PHY, PIR, 0x00060001);
	do {
		regval = HW_REG_READ1(DDR_PHY, PGSR0);
	} while ((regval & 0x80004001) != 0x80004001);

// Vref training is complete
// Check if any training errors then exit
	regval = ((HW_REG_READ1(DDR_PHY, PGSR0) & 0x1FFF0000) >>18);
	if(regval != 0) {
		raw_debug_printf("DDR PGSR0 != 0 2, DDR Init failed!!!\n");
		return;
	}

	HW_REG_MERGE_FIELD(DDR_PHY, PGCR3, RDMODE, 0x0U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL0DXCTL2, RDMODE, 0x0U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL1DXCTL2, RDMODE, 0x0U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL2DXCTL2, RDMODE, 0x0U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL3DXCTL2, RDMODE, 0x0U);
	HW_REG_MERGE_FIELD(DDR_PHY, DX8SL4DXCTL2, RDMODE, 0x0U);

// Vref training is complete, disabling static read mode
	HW_REG_WRITE1(DDR_PHY, DTCR0, 0x800091C7U);
	HW_REG_MERGE(DDR_PHY, PGCR2, 0x0003FFFFU, cur_R006_tREFPRD);

	HW_REG_WRITE1(DDR_PHY, PIR, 0x0000C001);
	do {
		regval = HW_REG_READ1(DDR_PHY, PGSR0);
	} while ((regval & 0x80000C01) != 0x80000C01);

	HW_REG_WRITE1(DDRC, ZQCTL0, 0x01000040U);
	HW_REG_WRITE1(DDRC, RFSHCTL3, 0x00000000U);
	HW_REG_MERGE(DDR_PHY, PGCR1, 0x00000040U, 0x00000000U);
}

void ddrRunInitProgram()
{
  psi_RunRegisterProgram(ddr_init);
  ddrPhybringup();
}

void ddrQosRunInitProgram()
{
  psi_RunRegisterProgram(ddr_qos_init);
}